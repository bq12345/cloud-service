// Generated by CoffeeScript 1.9.1

/*!
  Copyright baiqiang. All rights reserved.
  @file app.coffee
  @author baiqiang
  @version 1-0-0
 */

(function() {
  var _loading, app;

  app = angular.module('myApp', ['ngAnimate', 'ngRoute', 'ngSanitize']);

  app.config([
    '$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
      $routeProvider.when('/', {
        templateUrl: 'partials/contact.html',
        controller: IndexCtrl
      });
    }
  ]);

  app.directive('date', function() {
    return {
      restrict: 'E',
      replace: true,
      template: '<span>{{post.date| date:"yyyy-MM-dd HH:mm"}}</span>'
    };
  });

  app.service('Version', [
    '$rootScope', function($rootScope) {
      return {
        version: '0.0.1'
      };
    }
  ]);

  app.directive('ngEnter', function() {
    return function(scope, element, attrs) {
      return element.bind("keydown", function(event) {
        if (event.which === 13) {
          return scope.$apply(function() {
            return scope.$eval(attrs.ngEnter);
          });
        }
      });
    };
  });

  _loading = $('#loading');

  window.IndexCtrl = [
    '$scope', '$http', '$location', function($scope, $http, $location) {
      var _container;
      _container = $('#container');
      _loading.show();
      $scope.persons = [];
      $scope.checkIds = [];
      $http.get('/api/persons').success(function(data, status, headers, config) {
        _loading.hide();
        _container.css('opacity', 1);
        console.log(data);
        $scope.persons = data.list.filter(function(item, i) {
          return item.isdel === false;
        });
        return $scope.count = $scope.persons.length;
      });
      $scope.addUser = function() {
        $scope.batchCancel();
        $scope.addOrUpdate = true;
        $scope.p = {};
      };
      $scope.mergeUser = function() {
        _loading.show();
        setTimeout(function() {
          return _loading.hide();
        }, 1000);
      };
      $scope.personCheck = function($event, p) {
        if (p.checked) {
          p.checked = '';
        } else {
          p.checked = 'on';
        }
        $scope.calculate();
        $event.preventDefault();
        $event.stopPropagation();
      };
      $scope.checkAll = function(e) {
        if ($scope.checkedAll !== 'on') {
          $scope.checkedPersons = $scope.persons;
          $scope.persons.forEach(function(item) {
            return item.checked = 'on';
          });
          $scope.calculate();
        } else {
          $scope.batchCancel();
        }
      };
      $scope.batchCancel = function() {
        if ($scope.checkedPersons) {
          $scope.checkedPersons.forEach(function(item) {
            return item.checked = '';
          });
        }
        $scope.checkedAll = '';
        return $scope.selected = false;
      };
      $scope.calculate = function() {
        $scope.checkedPersons = $scope.persons.filter(function(item) {
          return item.checked;
        });
        $scope.checkIds = $scope.checkedPersons.map(function(item) {
          return item.id;
        });
        console.log($scope.checkIds);
        if ($scope.checkIds.length > 0) {
          if ($scope.checkIds.length === $scope.count) {
            $scope.checkedAll = 'on';
          }
          return $scope.selected = true;
        } else {
          return $scope.selected = false;
        }
      };
      $scope.modify = function(p) {
        $scope.batchCancel();
        $scope.addOrUpdate = true;
        $scope.p = p;
      };
      $scope.cancel = function() {
        $scope.addOrUpdate = false;
        $scope.p = {};
      };
      $scope.refreshUsers = function() {
        return location.reload();
      };
      $scope.recycle = function() {
        $('.content').html('<p class="recycle">该功能还未实现</p>');
      };
      $scope["delete"] = function() {
        $http.post('/api/post', {
          ids: $scope.checkIds
        }).success(function(data) {
          return console.log(data);
        });
      };
      return $scope.save = function(p) {
        $http.post('/api/cu.do', p).success(function(data) {
          return $location.url('/');
        });
      };
    }
  ];

}).call(this);

//# sourceMappingURL=contact.js.map
