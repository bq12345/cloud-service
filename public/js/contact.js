// Generated by CoffeeScript 1.8.0

/*!
  Copyright baiqiang. All rights reserved.
  @file app.coffee
  @author baiqiang
  @version 1-0-0
 */


/*
                   _ooOoo_
                  o8888888o
                  88" . "88
                  (| -_- |)
                  O\  =  /O
               ____/`---'\____
             .'  \\|     |//  `.
            /  \\|||  :  |||//  \
           /  _||||| -:- |||||-  \
           |   | \\\  -  /// |   |
           | \_|  ''\---/''  |   |
           \  .-\__  `-`  ___/-. /
         ___`. .'  /--.--\  `. . __
      ."" '<  `.___\_<|>_/___.'  >'"".
     | | :  `- \`.;`\ _ /`;.`/ - ` : | |
     \  \ `-.   \_ __\ /__ _/   .-` /  /
======`-.____`-.___\_____/___.-`____.-'======
                   `=---='
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         佛祖保佑       处处兼容
 */

(function() {
  var app;

  app = angular.module('myApp', ['ngAnimate', 'ngRoute', 'ngSanitize']);

  app.config([
    '$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
      $routeProvider.when('/', {
        templateUrl: 'partials/index.html',
        controller: IndexCtrl
      });
    }
  ]);

  app.directive('date', function() {
    return {
      restrict: 'E',
      replace: true,
      template: '<span>{{post.date| date:"yyyy-MM-dd HH:mm"}}</span>'
    };
  });

  app.service('Version', [
    '$rootScope', function($rootScope) {
      return {
        version: '0.0.1'
      };
    }
  ]);

  app.directive('ngEnter', function() {
    return function(scope, element, attrs) {
      return element.bind("keydown", function(event) {
        if (event.which === 13) {
          return scope.$apply(function() {
            return scope.$eval(attrs.ngEnter);
          });
        }
      });
    };
  });

  window.IndexCtrl = [
    '$scope', '$http', '$location', function($scope, $http, $location) {
      var $loading;
      $loading = $('#loading');
      $scope.persons = [];
      $scope.checkIds = [];
      $http.get('/api/persons').success(function(data, status, headers, config) {
        $loading.hide();
        console.log(data);
        $scope.persons = data.list.filter(function(item, i) {
          return item.isdel === false;
        });
        return $scope.count = $scope.persons.length;
      });
      $scope.addUser = function() {
        var $dialog;
        $dialog = $('#dialog');
        $scope.p = {};
        $dialog.show().animate({
          zIndex: 1,
          left: '40%'
        }, 200);
      };
      $scope.mergeUser = function() {
        $loading.show();
        setTimeout(function() {
          return $loading.hide();
        }, 1000);
      };
      $scope.modify = function(i, $event) {
        var $dialog, person;
        $dialog = $('#dialog');
        if ($event.target.tagName === 'INPUT' || $event.target.className.indexOf('check') > -1) {
          return;
        }
        person = $scope.persons[i];
        $scope.p = person;
        $dialog.show().animate({
          zIndex: 1,
          left: '40%'
        }, 200);
      };
      $scope.refreshUsers = function() {
        return location.reload();
      };
      $scope.recycle = function() {
        $('.content-header').removeClass('change');
        $('.content').html('<p class="recycle">该功能还未实现</p>');
      };
      $scope.check = function(e) {
        $(e.target).toggleClass('on');
        $scope.calculate();
      };
      $scope.checkAll = function(e) {
        var $checkbox;
        $checkbox = $('.checkbox');
        if ($checkbox.hasClass('on')) {
          $checkbox.removeClass('on');
        } else {
          $checkbox.addClass('on');
        }
        $scope.calculate();
      };
      $scope.calculate = function() {
        var $checks, $header;
        $checks = $('.checkbox.on', '.list');
        $scope.checkIds = $.map($checks, function(item) {
          return $(item).data('id');
        });
        console.log($scope.checkIds);
        $header = $('.content-header');
        if ($scope.checkIds.length > 0) {
          return $header.addClass('change');
        } else {
          return $header.removeClass('change');
        }
      };
      $scope["delete"] = function() {
        $http.post('/api/post', {
          ids: $scope.checkIds
        }).success(function(data) {
          return console.log(data);
        });
      };
      return $scope.save = function(p) {
        $http.post('/api/cu.do', p).success(function(data) {
          return $location.url('/');
        });
      };
    }
  ];

}).call(this);

//# sourceMappingURL=contact.js.map
