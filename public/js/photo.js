// Generated by CoffeeScript 1.9.1

/*!
  Copyright Â© 2015. All rights reserved.
  @file photo.coffee
  @author baiqiang
  @version 1-0-0
 */

(function() {
  var _loading, app;

  app = angular.module('photoApp', ['ngAnimate', 'ngRoute', 'ngSanitize']);

  app.config([
    '$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
      $routeProvider.when('/', {
        templateUrl: 'partials/photo.html',
        controller: PhotoCtrl
      });
    }
  ]);

  app.directive('date', function() {
    return {
      restrict: 'E',
      replace: true,
      template: '<span>{{day.value | dateFilter}}</span>'
    };
  });

  app.filter('dateFilter', function() {
    return function(input, param) {
      var date;
      date = new Date(input);
      return (date.getMonth() + 1) + '-' + date.getDay();
    };
  });

  _loading = $('#loading');

  window.PhotoCtrl = [
    '$scope', '$http', '$location', function($scope, $http, $location, $sce) {
      var _container;
      _container = $('#container');
      _loading.show();
      $scope.checkPhotos = [];
      $scope.photo = false;
      $scope.checkIds = [];
      $http.get('/api/photos').success(function(data) {
        _loading.hide();
        _container.css('opacity', 1);
        return $scope.years = data.list;
      });
      $scope.photoShow = function($event, photo) {
        return $scope.photo = photo;
      };
      $scope.photoShowCancel = function() {
        return $scope.photo = false;
      };
      $scope.photoCheck = function($event, photo) {
        $event.stopPropagation();
        if (photo.checked) {
          photo.checked = '';
          $scope.checkPhotos = $scope.checkPhotos.filter(function(item) {
            return item.id !== photo.id;
          });
        } else {
          photo.checked = 'on';
          $scope.checkPhotos.push(photo);
        }
        return $scope.calculate();
      };
      $scope.calculate = function() {
        $scope.checkIds = $scope.checkPhotos.map(function(item) {
          return item.id;
        });
        if ($scope.checkIds.length > 0) {
          console.log($scope.checkIds);
          return $scope.selected = true;
        } else {
          return $scope.selected = false;
        }
      };
      $scope["delete"] = function() {
        $http.post('/api/post', {
          ids: $scope.checkIds
        }).success(function(data) {
          return console.log(data);
        });
      };
      return $scope.cancel = function() {
        $scope.checkPhotos.forEach(function(item) {
          return item.checked = '';
        });
        $scope.checkPhotos = [];
        $scope.calculate();
      };
    }
  ];

}).call(this);

//# sourceMappingURL=photo.js.map
